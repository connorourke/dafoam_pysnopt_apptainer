Bootstrap: docker
From: connorourke/dafoam_pyoptsparse:3.1.2

%environment
export DAFOAM_ROOT_PATH=/home/dafoamuser/dafoam
export PATH=$DAFOAM_ROOT_PATH/packages/miniconda3/bin:$PATH
export LD_LIBRARY_PATH=$DAFOAM_ROOT_PATH/packages/miniconda3/lib:$LD_LIBRARY_PATH


%files
    pySNOPT/source  /home/dafoamuser/dafoam/repos/pyoptsparse-2.9.1/pyoptsparse/pySNOPT/source

%post
# set up python env
export PATH=/home/dafoamuser/dafoam/packages/miniconda3/bin:$PATH
export LD_LIBRARY_PATH=/home/dafoamuser/dafoam/packages/miniconda3/lib:$LD_LIBRARY_PATH

# install pyoptsparse
pip install --force-reinstall /home/dafoamuser/dafoam/repos/pyoptsparse-2.9.1


%test
. /home/dafoamuser/dafoam/loadDAFoam.sh
/home/dafoamuser/dafoam/packages/miniconda3/bin/python - <<EOF
from pyoptsparse import OPT
print("Available optimizers:", OPT.list_available())

if "SNOPT" in OPT.list_available():
    print("SNOPT enabled")
EOF

